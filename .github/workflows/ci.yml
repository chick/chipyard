
# !! WARNING !!
# Do not modify this file directly!
# !! WARNING !!
#
# It is generated from: ../../../../../../../../.github/actions/current-working.yml
# using the script from https://github.com/mithro/actions-includes

on:
- push
name: chipyard-ci-process
env:
  tools-cache-version: v6
jobs:
  install-riscv-toolchain:
    name: install riscv toolchain
    runs-on: ubuntu-latest
    container:
      image: ucbbar/chipyard-ci-image:ab57b7d
      options: --user root --entrypoint /bin/bash
    env:
      JVM_OPTS: -Xmx3200m
    steps:
    - uses: mithro/actions-includes@main
      continue-on-error: true
      with:
        workflow: .github/workflows/current-working.yml
    - name: fix permissions
      run: sudo chown -R riscvuser . ~riscvuser /github/home
    - name: Checkout
      uses: actions/checkout@v2
    - name: Generate Hashes
      run: .github/scripts/create-hash.sh
    - name: generate key
      id: genkey
      run: |
        echo "::set-output name=cache-key::riscv-tools-installed-${{ env.tools-cache-version }}-$(shasum riscv-tools.hash | cut -d' ' -f1)"
    - uses: actions/cache@v2
      id: riscv-tools-cache
      with:
        path: riscv-tools-install
        key: ${{ steps.genkey.outputs.cache-key }}
    - name: build tools-version if not cached
      if: steps.riscv-tools-cache.outputs.cache-hit != 'true'
      run: ./.github/scripts/build-toolchains.sh riscv-tools
  install-esp-toolchain:
    name: install esp toolchain
    runs-on: ubuntu-latest
    container:
      image: ucbbar/chipyard-ci-image:ab57b7d
      options: --user root --entrypoint /bin/bash
    env:
      JVM_OPTS: -Xmx3200m
    steps:
    - uses: mithro/actions-includes@main
      continue-on-error: true
      with:
        workflow: .github/workflows/current-working.yml
    - name: fix permissions
      run: sudo chown -R riscvuser . ~riscvuser /github/home
    - name: Checkout
      uses: actions/checkout@v2
    - name: Generate Hashes
      run: .github/scripts/create-hash.sh
    - name: generate key
      id: genkey
      run: |
        echo "::set-output name=cache-key::esp-tools-installed-${{ env.tools-cache-version }}-$(shasum esp-tools.hash | cut -d' ' -f1)"
    - uses: actions/cache@v2
      id: esp-tools-cache
      with:
        path: esp-tools-install
        key: ${{ steps.genkey.outputs.cache-key }}
    - name: build tools-version if not cached
      if: steps.esp-tools-cache.outputs.cache-hit != 'true'
      run: ./.github/scripts/build-toolchains.sh esp-tools
#  install-both:
#    needs:
#    - install-riscv-toolchain
#    - install-esp-toolchain
#    name: install both toolchains
#    runs-on: ubuntu-latest
#    container:
#      image: ucbbar/chipyard-ci-image:ab57b7d
#      options: --user root --entrypoint /bin/bash
#    env:
#      JVM_OPTS: -Xmx3200m
#    steps:
#    - uses: mithro/actions-includes@main
#      continue-on-error: true
#      with:
#        workflow: .github/workflows/current-working.yml
#    - name: fix permissions
#      run: sudo chown -R riscvuser . ~riscvuser /github/home
#    - name: Checkout
#      uses: actions/checkout@v2
#    - name: Generate Hashes
#      run: .github/scripts/create-hash.sh
#    - name: generate key
#      id: genkey
#      run: |
#        echo "::set-output name=cache-key::riscv-tools-installed-${{ env.tools-cache-version }}-$(shasum riscv-tools.hash | cut -d' ' -f1)"
#    - uses: actions/cache@v2
#      id: riscv-tools-cache
#      with:
#        path: riscv-tools-install
#        key: ${{ steps.genkey.outputs.cache-key }}
#    - name: build tools-version if not cached
#      if: steps.riscv-tools-cache.outputs.cache-hit != 'true'
#      run: ./.github/scripts/build-toolchains.sh riscv-tools
#    - name: Generate Hashes
#      run: .github/scripts/create-hash.sh
#    - name: generate key
#      id: genkey
#      run: |
#        echo "::set-output name=cache-key::esp-tools-installed-${{ env.tools-cache-version }}-$(shasum esp-tools.hash | cut -d' ' -f1)"
#    - uses: actions/cache@v2
#      id: esp-tools-cache
#      with:
#        path: esp-tools-install
#        key: ${{ steps.genkey.outputs.cache-key }}
#    - name: build tools-version if not cached
#      if: steps.esp-tools-cache.outputs.cache-hit != 'true'
#      run: ./.github/scripts/build-toolchains.sh esp-tools
#

